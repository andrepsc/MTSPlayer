/* siel-task.js Created on 25/02/2015 SIEL's task presentation control methods @version Revision 1.1.0 @since Build 1.0 (02 2015) @author Pedro Montibeler */
function beginSession(){$("#task").html('<div class="header"><div class="container" style="text-align: center"><input type="image" src="res/play.jpg" alt="SIEL Play" onclick="playIntro()"></div></div>'),toggleFullScreen()}function playIntro(){$("#task").html('<div class="header"><div class="container" style="text-align: center"><img id="logoSIEL" src="res/SIEL_Logo.png" alt="SIEL" style="display: none"></div></div>'),$("#logoSIEL").fadeIn(3e3,showNextTask)}function playOutro(){$("#task").html('<div class="header"><div class="container" style="text-align: center"><img id="logoSIEL" src="res/SIEL_Logo.png" alt="SIEL"></div></div>'),$("#logoSIEL").fadeOut(3e3,endSession)}function endSession(){if(toggleFullScreen(),loadMain(),null==document.getElementById("rep-table").rows[r+1].cells[5]){var e=document.getElementById("rep-table").rows[r+1].insertCell(5);e.innerHTML="<span onclick=\"showLog('"+fileNames[r]+"',"+r+')" class="glyphicon glyphicon-folder-open btn btn-primary" title="exibir log" style="color:#fff;"></span>'}}function confirmExit(){currentTaskHtml=document.getElementById("task").innerHTML;var e="<audio autoplay>";e=e.concat('<source src="res/confirmar.wav" type="audio/wav">'),e=e.concat('<source src="res/confirmar.mp3" type="audio/mpeg">'),e=e.concat('<source src="res/confirmar.ogg" type="audio/ogg">'),e=e.concat("</audio>"),e=e.concat('<div class="container marketing">'),e=e.concat('<div class="row">'),e=e.concat('<div class="col-lg-6 coluna">'),e=e.concat('<input type="image" src="res/cancel.png" onclick="document.getElementById(\'task\').innerHTML = currentTaskHtml;" style="width: 200px; height: 200px">'),e=e.concat("</div><!-- /.col-lg-6 coluna -->"),e=e.concat('<div class="col-lg-6 coluna">'),e=e.concat('<input type="image" src="res/check.png" onclick="playOutro();" style="width: 200px; height: 200px">'),e=e.concat("</div><!-- /.col-lg-6 coluna -->"),e=e.concat("</div><!-- /.row -->"),e=e.concat("</div><!-- /.container marketing -->"),document.getElementById("task").innerHTML=e}function loadTasksLocal(e){log[e]=[],log[e].dataSaved=!0,log[e].timeStamp=loadDate(),log[e].rep_response_time=0,log[e].pos_result_num=0,log[e].neg_result_num=0,mainHtml=document.getElementById("content").innerHTML,document.getElementById("content").innerHTML='<div class="vertical-center"><div id="task"></div></div><div id="hidden"></div>',r=e,t=0,reforcoPosHtml=generateReforcoHtml("pos","reforco/positivo.jpg","reforco/positivo"),reforcoNegHtml=generateReforcoHtml("neg","reforco/negativo.jpg","reforco/negativo");var o=document.getElementById("hidden");o.innerHTML=o.innerHTML+reforcoPosHtml,o.innerHTML=o.innerHTML+reforcoNegHtml,Ntasks=parsedFiles[e].length;for(var s=0;Ntasks>s;s++){var a=parsedFiles[e][s]["Tipo de Tarefa"],n=[];n.push(parsedFiles[e][s].Modelo);for(var l=1;14>=l&&""!=parsedFiles[e][s]["Comp"+l];l++)n.push(parsedFiles[e][s]["Comp"+l]);tasksHtml[s]=generateTaskHtml(e,s,a,n),o.innerHTML=o.innerHTML+tasksHtml[s],s==t&&beginSession()}}function checkReforco(){reforcoIndex[r][t][0]||reforcoIndex[r][t][1]?showReforco():(t++,showNextTask())}function showReforco(){respostaCerta?(reforcoIndex[r][t][0]&&$("#task").html(reforcoPosHtml),reforcoIndex[r][t][1]&&document.getElementById("r-pos-audio").play(),t++):respostaErrada&&(reforcoIndex[r][t][0]&&$("#task").html(reforcoNegHtml),reforcoIndex[r][t][1]&&document.getElementById("r-neg-audio").play()),setTimeout(showNextTask,2e3)}function showNextTask(){if(sol_clear(),t>Ntasks-1)playOutro();else if(tasksHtml[t]){if($("#task").html(tasksHtml[t]),progressIndex[r]){var e=100*t/Ntasks;$("#p-bar").html('<div class="progress"><div class="progress-bar" role="progressbar" aria-valuenow="'+e+'" aria-valuemin="0" aria-valuemax="100" style="width: '+e+'%;"><span class="sr-only">'+e+"% Completo</span></div></div>")}respostaCerta=!1,respostaErrada=!1,checkaudiohword(),timeCheckIn=(new Date).getTime(),log[r]["t"+t+".attempts"]>0||(log[r]["t"+t+".attempts"]=0,log[r]["t"+t+".total_response_time"]=0,log[r]["t"+t+".Tipo de Tarefa"]=parsedFiles[r][t]["Tipo de Tarefa"],log[r]["t"+t+".Modelo"]=parsedFiles[r][t].Modelo,log[r]["t"+t+".Comps"]=getComps(r,t))}}function respondeu(e){if(!respostaCerta&&!respostaErrada){timeCheckOut=(new Date).getTime(),log[r]["t"+t+".a"+log[r]["t"+t+".attempts"]+".response_time"]=(timeCheckOut-timeCheckIn)/1e3,log[r]["t"+t+".total_response_time"]+=log[r]["t"+t+".a"+log[r]["t"+t+".attempts"]+".response_time"],log[r].rep_response_time+=log[r]["t"+t+".a"+log[r]["t"+t+".attempts"]+".response_time"],log[r]["t"+t+".a"+log[r]["t"+t+".attempts"]+".response"]=e;var o=parsedFiles[r][t].Modelo,s=parsedFiles[r][t]["Tipo de Tarefa"];s=s.split(""),"E"==s[1]&&(o=joinWord(o)),e==o?(log[r]["t"+t+".a"+log[r]["t"+t+".attempts"]+".result"]="correto",log[r].pos_result_num++,respostaCerta=!0):(log[r]["t"+t+".a"+log[r]["t"+t+".attempts"]+".result"]="errado",log[r].neg_result_num++,respostaErrada=!0),log[r]["t"+t+".attempts"]++,checkReforco()}}function sol_add(e,t){if(!respostaCerta&&!respostaErrada&&!isInArray(t,silId)){var o=0,s="true"==sessionStorage.SilabasSalvas;s&&(o=parseInt(sessionStorage.NumeroSilabas)),o++,sessionStorage["sil."+o]=e,sessionStorage.NumeroSilabas=o,sessionStorage.SilabasSalvas=!0,document.getElementById("sil"+t).className="botao text-muted",silId.push(t);var r=sol_join();$("#soletrando").html(r)}}function sol_rem(){if(!respostaCerta&&!respostaErrada){var e=0,t="true"==sessionStorage.SilabasSalvas;if(t){e=parseInt(sessionStorage.NumeroSilabas),sessionStorage.removeItem("sil."+e);var o=silId.pop();if(document.getElementById("sil"+o).className="botao",e--,e>0){sessionStorage.NumeroSilabas=e;var s=sol_join();$("#soletrando").html(s)}else sol_clear()}}}function sol_join(){var e="",t=0,o="true"==sessionStorage.SilabasSalvas;for(o&&(t=parseInt(sessionStorage.NumeroSilabas)),i=1;t>=i;i++)e=e.concat(sessionStorage["sil."+i]);return e}function sol_end(){respostaCerta||respostaErrada||respondeu(sol_join())}function sol_clear(){var e=0,t="true"==sessionStorage.SilabasSalvas;for(t&&(e=parseInt(sessionStorage.NumeroSilabas),sessionStorage.removeItem("SilabasSalvas"),sessionStorage.removeItem("NumeroSilabas")),i=1;e>=i;i++)sessionStorage.removeItem("sil."+i);silId=[],$("#soletrando").html(" ")}function checkaudiohword(){document.getElementById("h-word-audio-"+t)&&playhword()}function playhword(){respostaCerta||respostaErrada||document.getElementById("h-word-audio-"+t).play()}var r=0,t=0,Ntasks,tasksHtml=[],currentTaskHtml,reforcoPosHtml,reforcoNegHtml,respostaCerta=!1,respostaErrada=!1,timeCheckIn,timeCheckOut;